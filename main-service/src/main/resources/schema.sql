CREATE TABLE IF NOT EXISTS categories (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  name VARCHAR(128) UNIQUE,
  CONSTRAINT pk_category PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL UNIQUE,
  name VARCHAR(250) NOT NULL,
  email VARCHAR(254) NOT NULL,
  CONSTRAINT pk_user PRIMARY KEY (id),
  CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS compilations (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  pinned boolean,
  title VARCHAR(50) NOT NULL,
  CONSTRAINT pk_compilation PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS events (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  CONSTRAINT pk_event PRIMARY KEY (id),
  annotation VARCHAR(2000) NOT NULL,
  category INTEGER REFERENCES categories (id) ON DELETE RESTRICT,
  confirmed_requests INTEGER,
  created_on TIMESTAMP WITHOUT TIME ZONE,
  description VARCHAR(7000) NOT NULL,
  event_date TIMESTAMP WITHOUT TIME ZONE,
  initiator INTEGER REFERENCES users (id) ON DELETE RESTRICT,
  lat FLOAT,
  lon FLOAT,
  paid boolean,
  participant_limit INTEGER,
  published_on TIMESTAMP WITHOUT TIME ZONE,
  request_moderation boolean,
  state VARCHAR(32),
  title VARCHAR(120) NOT NULL
);

CREATE TABLE IF NOT EXISTS compilations_events (
  event_id INTEGER REFERENCES events (id) ON DELETE CASCADE,
  compilation_id INTEGER REFERENCES compilations (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS requests (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created TIMESTAMP WITHOUT TIME ZONE,
  event INTEGER REFERENCES events (id) ON DELETE CASCADE,
  requester INTEGER REFERENCES users (id) ON DELETE RESTRICT,
  status VARCHAR(32) NOT NULL,
  CONSTRAINT pk_request PRIMARY KEY (id)
);
